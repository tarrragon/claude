# ğŸ”§ Hook ç³»çµ±å¿«é€Ÿåƒè€ƒ

## ğŸ“‹ Hook åŸ·è¡Œæµç¨‹

```mermaid
graph TD
    A[User Input] --> B[UserPromptSubmit Hook]
    B --> C[PreToolUse Hook]
    C --> D[Tool Execution]
    D --> E[PostToolUse Hook]
    E --> F[Stop Hook]

    B --> G[å·¥ä½œæµç¨‹æª¢æŸ¥]
    B --> H[ä»»å‹™é€ƒé¿åµæ¸¬]

    C --> I[é˜»æ­¢ç‹€æ…‹æª¢æŸ¥]
    C --> J[å®‰å…¨æª¢æŸ¥]

    E --> K[æ•ˆèƒ½ç›£æ§]
    E --> L[ç¨‹å¼ç•°å‘³åµæ¸¬]
    E --> M[æ–‡ä»¶æ›´æ–°æé†’]

    F --> N[ç‰ˆæœ¬æ¨é€²å»ºè­°]
    F --> O[PM è§¸ç™¼æª¢æŸ¥]
```

## ğŸ¯ ä¸‰å¤§éµå¾‹è‡ªå‹•åŸ·è¡Œ

| éµå¾‹ | Hook å¯¦ç¾ | è§¸ç™¼æ¢ä»¶ | åŸ·è¡Œæ–¹å¼ |
|------|-----------|----------|----------|
| **æ¸¬è©¦é€šéç‡éµå¾‹** | UserPromptSubmit + PreToolUse | ESLint éŒ¯èª¤æª¢æ¸¬ | è¨˜éŒ„è¿½è¹¤ + å¼·åˆ¶ä¿®å¾©æé†’ |
| **æ°¸ä¸æ”¾æ£„éµå¾‹** | Task Avoidance Detection | ç¦ç”¨è©å½™/é€ƒé¿è¡Œç‚º | **å®Œå…¨é˜»æ­¢æ“ä½œ** |
| **æ¶æ§‹å‚µå‹™é›¶å®¹å¿éµå¾‹** | Code Smell Detection + PostEdit | ç¨‹å¼ç•°å‘³åµæ¸¬ | è‡ªå‹• Agent è™•ç† |

## ğŸš¨ é—œéµ Hook èªªæ˜

### Task Avoidance Detection Hook
**æœ€é«˜å„ªå…ˆç´š - å¼·åˆ¶é˜»æ­¢æ©Ÿåˆ¶**

#### ç¦ç”¨è©å½™æ¸…å–®
```text
"å¤ªè¤‡é›œ", "æš«æ™‚", "è·³é", "ä¹‹å¾Œå†æ”¹", "å…ˆå°‡å°±"
"æš«æ™‚æ€§ä¿®æ­£", "ç—‡ç‹€ç·©è§£", "æ™‚é–“ä¸å¤ ", "è¤‡é›œåº¦å¤ªé«˜"
"ä¸åœ¨é€™æ¬¡ç¯„åœ", "ç•™å¾…å¾ŒçºŒè™•ç†", "workaround"
```

#### è§¸ç™¼é˜»æ­¢çš„æ¢ä»¶
- å·¥ä½œè¨˜éŒ„ä¸­åŒ…å«ä»»ä½•ç¦ç”¨è©å½™
- è·³éçš„æ¸¬è©¦ (`skip`, `pending`, `xdescribe`, `xit`)
- éå¤šçš„ ESLint å¿½ç•¥ (>5 è™•)
- æŠ€è¡“å‚µå‹™éåº¦ç´¯ç© (>15 å€‹ TODO/FIXME)
- ç¨‹å¼ç¢¼è®Šæ›´ä½†æ²’æœ‰æ¸¬è©¦æ›´æ–°

#### è§£é™¤é˜»æ­¢æµç¨‹
1. æª¢æŸ¥å ±å‘Š: `cat .claude/hook-logs/avoidance-reports/[latest].md`
2. ä¿®æ­£æ‰€æœ‰é€ƒé¿è¡Œç‚º
3. ç§»é™¤ç¦ç”¨è©å½™ï¼Œé‡æ–°æè¿°è§£æ±ºæ–¹æ¡ˆ
4. ä¿®å¾©æ‰€æœ‰è·³éçš„æ¸¬è©¦
5. è™•ç†æ‰€æœ‰æŠ€è¡“å‚µå‹™
6. åŸ·è¡Œ: `rm .claude/TASK_AVOIDANCE_BLOCK`

### Architecture Debt Detection Hook ğŸ†•
**æ¶æ§‹å‚µå‹™åµæ¸¬ - å¼·åˆ¶æ­£ç¢ºä¿®æ­£é †åº**

- **è§¸ç™¼æ™‚æ©Ÿ**: PostEdit - ç¨‹å¼ç¢¼è®Šæ›´å¾Œ
- **åŠŸèƒ½**:
  - åµæ¸¬é‡è¤‡æœå‹™å¯¦ä½œï¼ˆå¦‚å¤šå€‹ GoogleBooksApiServiceï¼‰
  - æª¢æŸ¥æ¶æ§‹åŸå‰‡é•è¦ï¼ˆDomain å±¤ä¾è³´å…·é«”å¯¦ä½œï¼‰
  - é©—è­‰æ¸¬è©¦æ¶æ§‹ä¸€è‡´æ€§ï¼ˆé‡è¤‡ Mockã€ä½¿ç”¨çœŸå¯¦æœå‹™ï¼‰
  - ç”Ÿæˆæ­£ç¢ºçš„é‡æ§‹é †åºæŒ‡å—
- **æ ¸å¿ƒåŸå‰‡**: **æ–‡ä»¶ â†’ æ¸¬è©¦ â†’ å¯¦ä½œ â†’ ä»‹é¢**
- **é˜»æ“‹æ©Ÿåˆ¶**: ç™¼ç¾æ¶æ§‹å•é¡Œæ™‚é˜»æ­¢ç¹¼çºŒåŸ·è¡Œï¼Œå¼·åˆ¶å…ˆä¿®æ­£æ–‡ä»¶å’Œæ¸¬è©¦
- **è¼¸å‡ºæª”æ¡ˆ**:
  - `.claude/hook-logs/architecture-issues.md` - è©³ç´°å•é¡Œå ±å‘Š
  - `.claude/ARCHITECTURE_REVIEW_REQUIRED` - å¯©æŸ¥æ¨™è¨˜

### Task Documentation Validation Hook ğŸ†•
**ä»»å‹™è¦åŠƒè‡ªå‹•æª¢æŸ¥ - æ–¹æ³•è«–åˆè¦æ€§**

- **è§¸ç™¼æ™‚æ©Ÿ**: PostEdit - å·¥ä½œæ—¥èªŒæª”æ¡ˆä¿®æ”¹å¾Œ
- **ç›®æ¨™æª”æ¡ˆ**: `docs/work-logs/v*.*.*.md`
- **åŸ·è¡Œé †åº**: order 30 (åœ¨ Code Smell Detection Hook ä¹‹å¾Œ)

#### æª¢æŸ¥é …ç›®

**å¼·åˆ¶ç« ç¯€** (å¿…é ˆå­˜åœ¨):
- ğŸ“‹ åƒè€ƒæ–‡ä»¶
- ğŸ“ å½±éŸ¿ç¯„åœ

**åƒè€ƒæ–‡ä»¶å­ç« ç¯€** (å¿…é ˆå®Œæ•´):
- UseCase åƒè€ƒ
- æµç¨‹åœ–åƒè€ƒï¼ˆå…·é«”åˆ° Eventï¼‰
- æ¶æ§‹è¦ç¯„
- ä¾è³´é¡åˆ¥
- æ¸¬è©¦è¨­è¨ˆåƒè€ƒ

**å½±éŸ¿ç¯„åœå­ç« ç¯€** (å¿…é ˆå®Œæ•´):
- éœ€è¦å»ºç«‹çš„æª”æ¡ˆ
- éœ€è¦ä¿®æ”¹çš„æª”æ¡ˆ
- é ä¼°å½±éŸ¿çš„æ¸¬è©¦æª”æ¡ˆ
- å½±éŸ¿çš„ä¾è³´é—œä¿‚

#### æª¢æŸ¥ç­‰ç´š

1. **âœ… å®Œå…¨ç¬¦åˆ**: æ‰€æœ‰å¼·åˆ¶ç« ç¯€å’Œå­ç« ç¯€éƒ½å­˜åœ¨
2. **âš ï¸ éƒ¨åˆ†ç¼ºå¤±**: å¼·åˆ¶ç« ç¯€å­˜åœ¨ï¼Œä½†å­ç« ç¯€ä¸å®Œæ•´
3. **âŒ åš´é‡ç¼ºå¤±**: ç¼ºå°‘å¼·åˆ¶ç« ç¯€ï¼Œä»»å‹™è¦åŠƒä¸åˆæ ¼

#### è¼¸å‡ºæª”æ¡ˆ

- æª¢æŸ¥å ±å‘Š: `.claude/hook-logs/task-doc-validation/validation-YYYYMMDD-HHMMSS.md`
- åŒ…å«è©³ç´°ç¼ºå¤±é …ç›®å’Œè£œå……å»ºè­°æ¨¡æ¿
- ç¼ºå¤±æ™‚æä¾›å®Œæ•´çš„åƒè€ƒæ–‡ä»¶å’Œå½±éŸ¿ç¯„åœæ¨¡æ¿

#### ä½¿ç”¨ç¯„ä¾‹

æŸ¥çœ‹æœ€æ–°æª¢æŸ¥å ±å‘Š:
```bash
ls -lt .claude/hook-logs/task-doc-validation/ | head -2
```

æ‰‹å‹•åŸ·è¡Œæª¢æŸ¥:
```bash
.claude/hooks/post-edit-task-doc-validation.sh docs/work-logs/v0.12.1-domain-interfaces.md
```

### Code Smell Detection Hook
**æ™ºèƒ½å“è³ªæ§åˆ¶ - Agent æ•´åˆ**

#### åµæ¸¬çš„ç¨‹å¼ç•°å‘³
- **é•·å‡½æ•¸** (>30è¡Œ)
- **æ·±å±¤å·¢ç‹€** (>4å±¤)
- **å¤§å‹é¡åˆ¥** (>200è¡Œ)
- **éé•·åƒæ•¸åˆ—è¡¨** (>5å€‹)
- **ç¨‹å¼ç¢¼é‡è¤‡** (>5è™•)
- **é­”è¡“æ•¸å­—** (>3è™•)
- **é«˜è€¦åˆ** (>10å€‹ä¾è³´)

#### Agent è‡ªå‹•è™•ç†æµç¨‹
1. åµæ¸¬ç•°å‘³ â†’ ç”Ÿæˆçµæ§‹åŒ–å ±å‘Š
2. å•Ÿå‹•èƒŒæ™¯ Agent â†’ æ›´æ–° TodoList
3. æŒ‰åš´é‡ç¨‹åº¦åˆ†é¡ (High/Medium/Low)
4. ä¸ä¸­æ–·é–‹ç™¼æµç¨‹

### Performance Monitor Hook
**ç³»çµ±æ•ˆèƒ½ç›£æ§**

#### æ•ˆèƒ½é–¾å€¼
- âœ… ç†æƒ³: < 1ç§’
- âš ï¸ è­¦å‘Š: 2-5ç§’
- âŒ éŒ¯èª¤: > 5ç§’

#### ç›£æ§æŒ‡æ¨™
- Hook åŸ·è¡Œæ™‚é–“
- è¨˜æ†¶é«”ä½¿ç”¨é‡
- åŸ·è¡Œé »ç‡çµ±è¨ˆ
- æ•ˆèƒ½è¶¨å‹¢åˆ†æ

### PM Trigger Hook
**æ™ºèƒ½å°ˆæ¡ˆç®¡ç†ä»‹å…¥æ©Ÿåˆ¶**

#### è§¸ç™¼æ¢ä»¶
- **TDD éšæ®µè½‰æ›**: Phase 1-4 å®Œæˆæ¨™è¨˜æª¢æ¸¬
- **é€²åº¦åœæ»¯**: å·¥ä½œæ—¥èªŒè¶…é 2 å¤©æœªæ›´æ–°
- **è¤‡é›œåº¦è¶…æ¨™**: æŠ€è¡“å‚µå‹™ >15 å€‹æˆ– ESLint éŒ¯èª¤ >50 å€‹
- **Agent å‡ç´šè«‹æ±‚**: å·¥ä½œæ—¥èªŒä¸­åŒ…å«å‡ç´šé—œéµå­—
- **é‡Œç¨‹ç¢‘æ¥è¿‘**: ç‰ˆæœ¬è™Ÿæ¥è¿‘é‡è¦ç¯€é» (0.9.x â†’ 1.0.0)

#### è§¸ç™¼å‹•ä½œ
- ç”Ÿæˆ PM ç‹€æ…‹æª”æ¡ˆ `.claude/pm-status.json`
- å»ºç«‹ä»‹å…¥æé†’ `.claude/PM_INTERVENTION_REQUIRED`
- è¨˜éŒ„è§¸ç™¼åŸå› å’Œç•¶å‰ä¸Šä¸‹æ–‡
- æä¾›å…·é«”çš„ PM è¡Œå‹•å»ºè­°

#### PM ç‹€æ…‹æª¢æŸ¥å·¥å…·
ä½¿ç”¨ `./scripts/pm-status-check.sh` æŸ¥çœ‹ï¼š
- è§¸ç™¼ç‹€æ…‹å’ŒåŸå› 
- ç•¶å‰å·¥ä½œé€²åº¦
- TodoList å„ªå…ˆç´šåˆ†æ
- æŠ€è¡“å‚µå‹™ç‹€æ³
- ç‰ˆæœ¬æ¨é€²å»ºè­°

## ğŸ“ Hook æª”æ¡ˆä½ç½®

```text
scripts/
â”œâ”€â”€ startup-check-hook.sh              # SessionStart
â”œâ”€â”€ prompt-submit-hook.sh               # UserPromptSubmit
â”œâ”€â”€ task-avoidance-detection-hook.sh    # UserPromptSubmit (é€ƒé¿åµæ¸¬)
â”œâ”€â”€ task-avoidance-block-check.sh       # PreToolUse (é˜»æ­¢æª¢æŸ¥)
â”œâ”€â”€ pre-commit-hook.sh                  # PreToolUse (Git)
â”œâ”€â”€ pre-test-hook.sh                    # PreToolUse (æ¸¬è©¦)
â”œâ”€â”€ post-edit-hook.sh                   # PostToolUse (ç·¨è¼¯)
â”œâ”€â”€ post-test-hook.sh                   # PostToolUse (æ¸¬è©¦)
â”œâ”€â”€ code-smell-detection-hook.sh        # PostToolUse (ç•°å‘³åµæ¸¬)
â”œâ”€â”€ post-edit-task-doc-validation.sh    # PostToolUse (ä»»å‹™è¦åŠƒæª¢æŸ¥) ğŸ†•
â”œâ”€â”€ architecture-debt-detection-hook.sh # PostToolUse (æ¶æ§‹å‚µå‹™æª¢æ¸¬)
â”œâ”€â”€ auto-documentation-update-hook.sh   # PostToolUse (æ–‡ä»¶æé†’)
â”œâ”€â”€ performance-monitor-hook.sh         # é€šç”¨æ•ˆèƒ½ç›£æ§
â”œâ”€â”€ stop-hook.sh                        # Stop
â”œâ”€â”€ pm-trigger-hook.sh                  # Stop (PM è§¸ç™¼æª¢æŸ¥)
â””â”€â”€ pm-status-check.sh                  # PM ç‹€æ…‹æª¢æŸ¥å·¥å…·
```

## ğŸ”§ è¨­å®šæª”æ¡ˆ

**`.claude/settings.local.json`** - Hook é…ç½®
- SessionStart: ç’°å¢ƒæª¢æŸ¥
- UserPromptSubmit: åˆè¦æ€§æª¢æŸ¥ + é€ƒé¿åµæ¸¬
- PreToolUse: é˜»æ­¢æª¢æŸ¥ + å®‰å…¨æª¢æŸ¥
- PostToolUse: å“è³ªæª¢æŸ¥ + ç•°å‘³åµæ¸¬ + æ–‡ä»¶æé†’
- Stop: ç‰ˆæœ¬æ¨é€²å»ºè­°

## ğŸ“Š æ—¥èªŒå’Œå ±å‘Š

### æ—¥èªŒä½ç½®
```text
.claude/hook-logs/
â”œâ”€â”€ startup-[timestamp].log
â”œâ”€â”€ prompt-submit-[timestamp].log
â”œâ”€â”€ post-edit-[timestamp].log
â”œâ”€â”€ code-smell-[timestamp].log
â”œâ”€â”€ task-doc-validation/           # ä»»å‹™æ–‡ä»¶æª¢æŸ¥å ±å‘Š ğŸ†•
â”‚   â””â”€â”€ validation-[timestamp].md
â”œâ”€â”€ performance/
â”‚   â”œâ”€â”€ perf-monitor-[date].log
â”‚   â””â”€â”€ metrics.csv
â”œâ”€â”€ smell-reports/
â”œâ”€â”€ avoidance-reports/
â””â”€â”€ issues-to-track.md
```

### é‡è¦æª”æ¡ˆ
- **`.claude/TASK_AVOIDANCE_BLOCK`** - é˜»æ­¢ç‹€æ…‹æ¨™è¨˜
- **`.claude/pm-status.json`** - PM è§¸ç™¼ç‹€æ…‹è¨˜éŒ„
- **`.claude/PM_INTERVENTION_REQUIRED`** - PM ä»‹å…¥æé†’æ¨™è¨˜
- **`issues-to-track.md`** - å•é¡Œè¿½è¹¤æé†’
- **`metrics.csv`** - æ•ˆèƒ½ç›£æ§è³‡æ–™

## âš¡ ç·Šæ€¥æ“ä½œ

### è§£é™¤æ‰€æœ‰é˜»æ­¢
```bash
# åƒ…åœ¨ç·Šæ€¥æƒ…æ³ä¸‹ä½¿ç”¨
rm -f .claude/TASK_AVOIDANCE_BLOCK
```

### æª¢æŸ¥ç•¶å‰ç‹€æ…‹
```bash
# æª¢æŸ¥æ˜¯å¦æœ‰é˜»æ­¢ç‹€æ…‹
ls -la .claude/TASK_AVOIDANCE_BLOCK

# æª¢æŸ¥ PM è§¸ç™¼ç‹€æ…‹
./scripts/pm-status-check.sh

# æŸ¥çœ‹æœ€æ–°å•é¡Œ
cat .claude/hook-logs/issues-to-track.md

# æª¢æŸ¥æœ€æ–°ç•°å‘³å ±å‘Š
ls -t .claude/hook-logs/smell-reports/ | head -1
```

### æ‰‹å‹•åŸ·è¡Œé—œéµæª¢æŸ¥
```bash
# æ‰‹å‹•åŸ·è¡Œé€ƒé¿åµæ¸¬
./scripts/task-avoidance-detection-hook.sh

# æ‰‹å‹•åŸ·è¡Œç¨‹å¼ç•°å‘³æª¢æŸ¥
./scripts/code-smell-detection-hook.sh

# æ‰‹å‹•åŸ·è¡Œæ•ˆèƒ½åˆ†æ
./scripts/performance-monitor-hook.sh

# æ‰‹å‹•åŸ·è¡Œ PM è§¸ç™¼æª¢æŸ¥
./scripts/pm-trigger-hook.sh
```

## ğŸ¯ æœ€ä½³å¯¦è¸

### é–‹ç™¼è€…æŒ‡å¼•
1. **ç†è§£é˜»æ­¢æ©Ÿåˆ¶** - ä¸è¦å˜—è©¦ç¹éï¼Œå°ˆæ³¨æ–¼ä¿®æ­£å•é¡Œ
2. **æ¥å—å“è³ªæ¨™æº–** - Hook ç³»çµ±æ˜¯ç‚ºäº†ç¢ºä¿ç¨‹å¼ç¢¼å“è³ª
3. **å­¸ç¿’æ”¹å–„** - æŸ¥çœ‹å ±å‘Šäº†è§£æ”¹å–„æ–¹å‘
4. **ä¸»å‹•é é˜²** - é–‹ç™¼æ™‚å°±é¿å…ç”¢ç”Ÿç•°å‘³

### å°ˆæ¡ˆç®¡ç†æŒ‡å¼•
1. **ç›£æ§è¶¨å‹¢** - å®šæœŸæª¢æŸ¥æ•ˆèƒ½å’Œå“è³ªè¶¨å‹¢
2. **èª¿æ•´é–¾å€¼** - æ ¹æ“šå°ˆæ¡ˆç‰¹æ€§èª¿æ•´æª¢æŸ¥æ¨™æº–
3. **åŸ¹è¨“åœ˜éšŠ** - ç¢ºä¿åœ˜éšŠç†è§£ Hook ç³»çµ±é‹ä½œ
4. **æŒçºŒæ”¹å–„** - æ ¹æ“šå¯¦éš›ä½¿ç”¨æƒ…æ³å„ªåŒ– Hook

é€™å€‹ Hook ç³»çµ±ç¢ºä¿å°ˆæ¡ˆå§‹çµ‚ç¶­æŒæœ€é«˜çš„å“è³ªæ¨™æº–ï¼Œæ˜¯å°ˆæ¡ˆæˆåŠŸçš„é‡è¦åŸºç¤è¨­æ–½ã€‚
