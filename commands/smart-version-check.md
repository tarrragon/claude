# Claude 指令：Smart-Version-Check

此命令協助您檢查工作狀態並自動決定版本推進策略。

> ⚠️ **重要**: 此指令是 Claude Code 內建功能，在繼續對話或恢復 session 時可能不可用。若指令無效，請使用替代方案：`./scripts/version-progression-check.sh`。

## 使用方法

要執行版本推進檢查，輸入：

```
/smart-version-check
```

## ⚠️ 指令不可用時的替代方案

```bash
# 手動執行版本推進檢查流程
./scripts/check-version-sync.sh        # 1. 版號同步檢查
./scripts/check-work-log.sh            # 2. 工作日誌檢查
./scripts/check-next-objectives.sh     # 3. 下一步目標檢查
./scripts/version-progression-check.sh # 4. 版本推進決策
```

## 🚀 系統指令

你是一名 **版本推進檢查專家**，負責檢查工作狀態並自動決定版本推進策略。

## 🔍 版本推進決策邏輯

### 📊 四階段檢查流程

執行以下四個階段的自動化檢查，並根據結果提供版本推進建議：

#### 1. 版號同步檢查

```bash
# 檢查 package.json 與實際開發進度同步
./scripts/check-version-sync.sh
```

**檢查內容**：
- package.json 版本號是否與當前工作日誌版本一致
- 版本號格式是否正確 (語意化版本控制)
- 確保版本號反映真實開發進度

#### 2. 工作日誌狀態檢查

```bash
# 檢查當前小版本工作完成狀態
./scripts/check-work-log.sh
```

**分析內容**：
- 當前工作日誌是否標記為完成 (✅)
- 工作項目完成度和品質狀態
- 是否有未完成的技術債務

#### 3. 下一步目標分析

```bash
# 檢查中版本層級的 todolist.md 任務狀態
./scripts/check-next-objectives.sh
```

**評估重點**：
- todolist.md 中當前版本系列 (如 v0.10.x) 目標完成度
- 下一步開發方向和優先級
- 中版本目標是否已完成

#### 4. 版本推進決策

```bash
# 整合分析，提供版本推進建議
./scripts/version-progression-check.sh
```

**決策輸出**：系統將提供以下四種決策之一：

### 🎯 決策類型與操作建議

#### 決策A: 繼續當前版本開發 (decision_code = 0)
**觸發條件**：當前工作尚未完成
**建議操作**：
```bash
./scripts/work-log-manager.sh
# 選擇選項 1: 📝 更新進行中的工作
```

#### 決策B: 小版本推進 (decision_code = 1)
**觸發條件**：當前工作完成，但版本系列目標未完成
**建議操作**：
```bash
# 推進到下一個小版本 (patch: 0.10.12 → 0.10.13)
./scripts/work-log-manager.sh
# 選擇選項 2: 🆕 開始新的工作項目
# 系統會自動建立新版本工作日誌
```

#### 決策C: 中版本推進 (decision_code = 2)
**觸發條件**：當前工作完成，且版本系列目標完成
**建議操作**：
```bash
# 推進到下一個中版本 (minor: 0.10.x → 0.11.0)
./scripts/work-log-manager.sh
# 選擇選項 2: 🆕 開始新的工作項目
# 需要手動更新 package.json 到中版本
# 並更新 todolist.md 規劃新版本系列目標
```

#### 決策D: 完成當前工作並總結
**觸發條件**：當前工作項目需要完成總結
**建議操作**：
```bash
./scripts/work-log-manager.sh
# 選擇選項 3: ✅ 完成當前工作
```

## 🛠 自動執行動作

版本推進檢查會自動執行以下動作：

### ✅ 自動化版本管理
- **版本號更新**: 根據決策結果更新 package.json 版本號
- **工作日誌管理**: 建立新版本的工作日誌檔案
- **任務重新排序**: 重新排序 todolist.md 任務優先級
- **狀態同步**: 確保三層文件管理架構同步

### 🔄 版本推進自動化流程

```bash
# 根據決策結果自動執行對應的版本管理操作
case $decision_code in
    0) echo "繼續當前開發，更新工作進度" ;;
    1) echo "推進小版本，建立新工作日誌" ;;
    2) echo "推進中版本，需要更新規劃" ;;
    *) echo "完成工作總結" ;;
esac
```

### 📋 版本推進驗證檢查

**推進後自動驗證**：
- 版本號一致性檢查
- 工作日誌檔案建立確認
- todolist.md 更新狀態驗證
- 文件架構完整性檢查

## ⚡ 智能決策特色

### 🧠 避免版本錯誤判斷

**防止常見錯誤**：
- ❌ 避免當前處於 0.9.x 階段卻使用 v1.0.0 標記
- ❌ 避免工作未完成就推進版本
- ❌ 避免版本號與實際開發狀態不同步

**智能分析機制**：
- 📊 分析歷史工作日誌推斷正確版本
- 🎯 根據 todolist.md 評估版本系列完成度
- 🔍 檢查 package.json 與實際開發進度差異

### 📈 版本推進最佳化

**推進策略最佳化**：
- ⚡ 自動識別最適合的版本推進時機
- 🎯 提供明確的下一步行動建議
- 📝 自動生成版本推進說明和記錄

## 🚨 問題處理指引

### 版本同步異常

```bash
# 如果 package.json 與工作日誌版本不同步
echo "⚠️  版本不同步，需要手動修正："
echo "1. 檢查 package.json 版本"
echo "2. 檢查最新工作日誌版本"
echo "3. 確定正確版本並同步"
```

### 工作狀態不明確

```bash
# 如果無法判斷工作完成狀態
echo "⚠️  工作狀態不明確，請執行："
echo "1. 檢查最新工作日誌內容"
echo "2. 確認是否有 ✅ 完成標記"
echo "3. 評估當前工作項目進度"
```

### 版本推進衝突

```bash
# 如果版本推進決策有衝突
echo "⚠️  版本推進衝突，建議："
echo "1. 先完成當前工作項目"
echo "2. 確認 todolist.md 狀態"
echo "3. 手動執行版本推進"
```

## 📊 輸出報告格式

版本推進檢查完成後，會輸出包含以下內容的詳細報告：

### 🔍 檢查結果摘要

**版本狀態**：
- 當前版本：package.json 中的版本號
- 工作狀態：當前工作完成度
- 推進建議：具體的版本推進建議

**決策分析**：
- 決策代碼：0-3 的決策結果
- 推進類型：繼續/小版本/中版本/完成
- 操作建議：具體的執行命令

**下一步行動**：
- 立即行動：需要立即執行的操作
- 後續規劃：版本推進後的開發方向
- 檔案更新：需要更新的文件清單